
### 实验目标
设计一个基于 **MIPS 指令集** 的 CPU，要求支持以下功能和指令：
1. 必须支持指令：
   - `add`, `sub`, `addi`, `lw`, `sw`, `beq`, `j`, `nop`
2. CPU 必须包含以下模块：
   - **寄存器组**
   - **RAM 模块**
   - **ALU 模块**
   - **指令译码模块**
3. 实现基本汇编指令的执行。
4. 可选实现（更高分要求）：
   - **多周期 CPU**（难度 B- 至 B+）
   - **以下高级功能之一**（难度 A- 至 A+）
     - 五级流水线 CPU
     - 超标量架构
     - 四路组相联缓存
   - 可基于其他指令集（如 RISC-V 或 ARM）实现。

---

### 实验基本框架

#### 单周期 CPU
1. **设计原理**：
   - 每条指令在一个时钟周期内完成。
   - 使用 PC 指向当前指令，在指令存储器（IM）中获取指令。
   - 指令译码生成控制信号。
   - ALU 执行运算，结果写回寄存器。
   - PC 地址自增 4，指向下一指令。

2. **指令支持**：
   - R-Type（`add`, `sub`）：包括操作码、功能码。
   - I-Type（`addi`, `lw`, `sw`, `beq`）：含立即数操作和内存访问。
   - J-Type（`j`）：无条件跳转。
   - `nop`：空操作。

3. **关键模块**：
   - **控制单元**：
     - 提供控制信号（如 `RegWrite`, `MemToReg`, `ALUSrc` 等）。
   - **ALU**：
     - 支持加减法、逻辑运算（与、或、非）。
   - **寄存器文件**：
     - 提供寄存器的读写功能。
   - **数据存储器**：
     - 用于 `lw` 和 `sw` 指令的内存读写。

4. **代码框架**：
   - 模块定义：
     - 时钟、复位信号。
     - 寄存器组、ALU 运算单元。
     - 控制信号生成和指令译码逻辑。
     - 数据存储模块及写回逻辑。

---

#### 多周期 CPU
1. **设计原理**：
   - 将指令执行分为多个阶段（如取指、译码、执行、访存、写回）。
   - 每个阶段占用一个时钟周期。
   - 使用有限状态机（FSM）控制指令的执行流程。

2. **状态划分**：
   - FETCH：取指令，PC 地址加 4。
   - DECODE：指令译码，生成控制信号。
   - EXECUTE：ALU 执行。
   - MEM_ACCESS：内存访问（如 `lw`, `sw`）。
   - WRITE_BACK：将结果写回寄存器。

3. **关键模块**：
   - **状态机**：
     - 控制指令在各阶段的流转。
   - **符号扩展**：
     - 对立即数进行符号位扩展。
   - **寄存器选择逻辑**：
     - 根据指令类型选择写入的寄存器。

4. **控制单元实现**：
   - 根据操作码生成相应控制信号。
   - 状态机实现指令的多周期操作。

---

#### 五级流水线 CPU
1. **设计思路**：
   - 引入流水线技术，减少指令执行的延迟。
   - 五个阶段：
     - **取指**（IF）：从指令存储器读取指令。
     - **译码**（ID）：生成控制信号，读取寄存器值。
     - **执行**（EX）：ALU 运算。
     - **访存**（MEM）：内存读写。
     - **写回**（WB）：将结果写回寄存器。

2. **冒险处理**：
   - **数据冒险**：使用前推单元解决。
   - **控制冒险**：引入分支预测。
   - **结构冒险**：增加硬件资源或使用调度技术。

3. **模块改进**：
   - 添加 **前推单元**（Forwarding Unit）和 **分支预测单元**（Branch Prediction Unit）。
   - 在执行阶段和访存阶段分别处理数据冒险和控制冒险。

---

### 实验要求
- **代码实现**：
  - 不得抄袭，否则成绩记为不及格。
  - 保证代码完整性，模块设计清晰。

- **测试与验证**：
  - 确保所有指令执行正确，包括算术、逻辑、跳转和内存访问。
  - 在仿真环境下测试 CPU 的完整功能。

---

### 总结
本实验通过对单周期、多周期和五级流水线 CPU 的设计与实现，全面理解 MIPS 架构下 CPU 的基本工作原理与实现方法。核心模块包括控制单元、ALU、寄存器组、指令存储和数据存储。高级功能如超标量和缓存设计可根据时间和能力进行拓展。